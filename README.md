# BioUnfold Dev Environment üß™

This repository provides a **fully reproducible Jupyter + Python environment** using
**[Docker](https://www.docker.com)** and **[uv](https://github.com/astral-sh/uv)** for dependency management.

No Conda. No global installs. One `make` away from running notebooks locally or on a GPU server.

---

## üß∞ Prerequisites

* **[Homebrew](https://brew.sh)** (macOS)
* **Docker Desktop** (macOS) or Docker Engine (Linux)
* **uv** (fast Python dependency resolver)

```bash
# Install uv and Docker on macOS
brew install uv
brew install --cask docker
brew install ruby
# Start Docker Desktop manually the first time
```

Check installations:

```bash
docker --version
docker compose version
uv --version
```

---

## üêç Python dependencies

Python dependencies are managed through `pyproject.toml` and a lockfile.

To update dependencies:

```bash
uv lock --python 3.11
uv export --format requirements-txt --python 3.11 --output-file requirements.lock.txt
```

This ensures a **frozen** set of versions compatible with the Python version in the Docker image (`3.11`).

---

## üê≥ Build and run with Docker

```bash
make build
make up
```

Then open [http://localhost:8888](http://localhost:8888) in your browser.

---

## Website (Jekyll + Bundler)

Initial setup (one-time):
```bash
cd docs
# ensure gem executables are on PATH (macOS Homebrew Ruby)
echo 'export PATH="/opt/homebrew/opt/ruby/bin:$PATH"' >> ~/.zshrc
source ~/.zshrc
gem install bundler
bundle config set --local path vendor/bundle
bundle install
cd ..
```
Serve localy:
```bash
make serve
```
This runs:
```bash
cd docs && bundle exec jekyll serve --drafts --future --livereload
```

## üìù Typical workflow

1. **Edit code / notebooks locally** in Neovim or your editor.
   The repo is mounted inside the container, so all changes persist.

2. **Run JupyterLab** inside Docker with `make up`.

3. **Add dependencies** by editing `pyproject.toml`, then:

   ```bash
   uv lock --python 3.11
   uv export --format requirements-txt --python 3.11 --output-file requirements.lock.txt
   make build
   ```

4. Commit both `pyproject.toml` and `requirements.lock.txt` so builds remain reproducible.

---

## üß™ Optional local runtime for Colab

If you prefer the Colab interface:

* Run `make up` locally
* In Colab ‚Üí **Connect to local runtime** ‚Üí URL `http://localhost:8888`

---

## üßº Useful Make targets

```bash
make lock         # lock deps (uv) and export pip requirements
make build        # build Docker image (CPU by default)
make up           # run JupyterLab (CPU)
make down         # stop Docker containers
make clean        # stop + remove volumes
make nuke         # prune dangling images
make serve        # run Jekyll website locally
make dev          # start Jupyter (detached) + Jekyll (foreground)
make dev-stop     # stop both (best-effort)
```

---

## üß≠ Repository structure

```
BioUnfold/
  notebooks/
  bio_unfold_viz/
  docs/                   # Jekyll site
  pyproject.toml
  requirements.lock.txt   # generated by `make lock`
  Dockerfile
  docker-compose.yml
  Makefile
  README.md
```

---

## üß† Example visualization

```python
import matplotlib.pyplot as plt
from bio_unfold_viz.templates import bridge_diagram

fig, ax = plt.subplots(figsize=(8,3))
bridge_diagram(
    ax,
    left=["Biology constraints", "Assay limits", "Noise & bias"],
    right=["Model capabilities", "Generalization", "Failure modes"],
    caption="Translating biological reality into AI decisions (and back)",
)
plt.show()
```

---

## üöÄ Tips

* Re-lock dependencies after modifying `pyproject.toml`.
* If you get UID/GID permission issues on Linux servers, pass your UID/GID in the `make` command:

  ```bash
  UID=$(id -u) GID=$(id -g) make up
  ```
* If you want to reproduce the same environment on another server:

  ```bash
  git clone <repo>
  make build
  make up
  ```

